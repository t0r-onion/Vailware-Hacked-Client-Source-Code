package toniqx.vailware.modules.exploit;

import java.util.Queue;
import java.util.concurrent.ConcurrentLinkedQueue;

import org.lwjgl.input.Keyboard;

import com.mojang.realmsclient.gui.ChatFormatting;

import net.minecraft.client.entity.EntityOtherPlayerMP;
import net.minecraft.entity.player.PlayerCapabilities;
import net.minecraft.nbt.NBTTagCompound;
import net.minecraft.network.Packet;
import net.minecraft.network.play.client.C03PacketPlayer;
import net.minecraft.network.play.client.C0BPacketEntityAction;
import net.minecraft.network.play.client.C0CPacketBoatInput;
import net.minecraft.network.play.client.C0FPacketConfirmTransaction;
import net.minecraft.network.play.server.S05PacketSpawnPosition;
import net.minecraft.network.play.server.S12PacketEntityVelocity;
import net.minecraft.network.play.server.S14PacketEntity;
import net.minecraft.network.play.server.S18PacketEntityTeleport;
import net.minecraft.network.play.server.S19PacketEntityHeadLook;
import net.minecraft.network.play.server.S1CPacketEntityMetadata;
import net.minecraft.network.play.server.S22PacketMultiBlockChange;
import net.minecraft.network.play.server.S23PacketBlockChange;
import net.minecraft.network.play.server.S24PacketBlockAction;
import net.minecraft.network.play.server.S27PacketExplosion;
import net.minecraft.network.play.server.S2APacketParticles;
import net.minecraft.network.play.server.S32PacketConfirmTransaction;
import net.minecraft.world.WorldSettings.GameType;
import toniqx.vailware.Client;
import toniqx.vailware.main.event.Event;
import toniqx.vailware.main.event.listeners.EventReceivePacket;
import toniqx.vailware.main.event.listeners.EventRotationMotion;
import toniqx.vailware.main.event.process.EventPacket;
import toniqx.vailware.main.settings.impl.ModeSetting;
import toniqx.vailware.main.util.impl.TimerUtils;
import toniqx.vailware.main.util.impl.movement.MovementUtil;
import toniqx.vailware.main.util.impl.server.Stopwatch;
import toniqx.vailware.modules.Module;

public class Disabler extends Module {

	public static ModeSetting dmode = new ModeSetting("Mode", "Ping", "Ping", "Verus", "AAC4", "Vicnix");
	private final Queue<Packet> packetQueue = new ConcurrentLinkedQueue();
	private final TimerUtils timer = new TimerUtils();
	private final int[] counter = new int[8];
	
    public double oldX;
    public double oldY;
    public double oldZ;
    public float oldYaw;
    public float oldPitch;
    public EntityOtherPlayerMP player;
	
	public Disabler(){
		super("Disabler", "", Keyboard.KEY_NONE, Category.EXPLOIT);
		this.addSettings(dmode);
	}
	
	public void onEnable() {

	}
	
	public void onDisable(){
		mc.timer.timerSpeed = 1.0f;	
	}
	
	public void onEvent(Event e){
		if (dmode.is("AAC4")) {
			super.mname = ChatFormatting.GRAY + "AAC4" + "   ";
	        if (e instanceof EventPacket) {
	        	
	        	
	        	EventPacket event = (EventPacket) e;
	            Packet<?> packet = event.getPacket();
	            
	            if(packet instanceof S12PacketEntityVelocity) {
	            	if(packet instanceof S12PacketEntityVelocity) {
	                    mc.thePlayer.sendQueue.addToSendQueue(new C0FPacketConfirmTransaction());
	                }
	            }
	         
	        }
		}
		else if (dmode.is("Ping")) {
			super.mname = ChatFormatting.GRAY + "Ping" + "   ";
		}
		else if (dmode.is("Vicnix")) {
			super.mname = ChatFormatting.GRAY + "Vicnix" + "   ";
			
			if(e instanceof EventPacket) {
				if(((EventPacket) e).getPacket() instanceof C03PacketPlayer) {
                    C03PacketPlayer packetPlayer = (C03PacketPlayer) ((EventPacket) e).getPacket();
                    PlayerCapabilities c = new PlayerCapabilities ();
                    c.allowFlying = true;
                    c.isCreativeMode = true;
                    c.disableDamage = true;
                    packetPlayer.moving = false;
                    if(mc.thePlayer.ticksExisted % 2 == 0) {
                        packetPlayer.onGround = true;
                        c.setFlySpeed(Float.MAX_VALUE);
                        c.setPlayerWalkSpeed(Float.POSITIVE_INFINITY);
                        e.setCancelled(true);
                    }
                }
			}
			
		}else if(dmode.is("Verus")) {
			super.mname = ChatFormatting.GRAY + "Verus" + "   ";
	        if (e instanceof EventPacket) {
	        	
	            EventPacket event = (EventPacket) e;
	            Packet<?> packet = event.getPacket();
				if (packet instanceof C0FPacketConfirmTransaction) {
					if (timer.delay(mc.thePlayer.ticksExisted < 1000 ? 6800 : 10000)) {
						if (mc.thePlayer.ticksExisted < 1000) {
							mc.timer.timerSpeed = 0.2f;
						}
						mc.thePlayer.sendQueue.addToSendQueue(new C03PacketPlayer.C04PacketPlayerPosition(-5, -411, -6, false));
						if (!packetQueue.isEmpty()) {
							mc.thePlayer.sendQueue.addToSendQueue(packetQueue.poll());
						}
						counter[0] = 0;
						timer.reset();
					}
					packetQueue.add(packet);
					e.setCancelled(true);
				}
				
				if (packet instanceof C03PacketPlayer) {
					if (mc.thePlayer.ticksExisted < 1000) {
						if (mc.timer.timerSpeed == 0.2F) {
							mc.timer.timerSpeed = 1.0F;
						}
					}
					if (counter[0] <= 1 || mc.thePlayer.ticksExisted % 2 == 0) {
						e.setCancelled(true);
						counter[0]++;
					}
				}
				if (packet instanceof C0BPacketEntityAction) {
					e.setCancelled(true);
				}
				
				if (mc.thePlayer != null && mc.thePlayer.ticksExisted <= 2) {
					packetQueue.clear();
					counter[0] = 0;
				}
	        }
		}
	}
	
}
