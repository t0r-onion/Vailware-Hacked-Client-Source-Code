package toniqx.vailware.modules.exploit;

import org.lwjgl.input.Keyboard;

import com.mojang.realmsclient.gui.ChatFormatting;

import net.minecraft.network.play.client.C00PacketKeepAlive;
import toniqx.vailware.Client;
import toniqx.vailware.main.event.Event;
import toniqx.vailware.main.event.listeners.EventUpdate;
import toniqx.vailware.main.event.process.EventPacket;
import toniqx.vailware.modules.Module;

public class NoPacketKick extends Module
{
    int sentThisSecond;
    int ticks;
    
    public NoPacketKick() {
        super("NoPacketKick", "", Keyboard.KEY_NONE, Category.EXPLOIT);
    }
    
    @Override
    public void onEnable() {
        this.ticks = 0;
        this.sentThisSecond = 0;
    }
    
    @Override
    public void onEvent(Event e) {
        if (e instanceof EventUpdate) {
            ++this.ticks;
            if (this.ticks % 20 == 0) {
                this.sentThisSecond = 0;
            }
        }
        if (e instanceof EventPacket) {
            ++this.sentThisSecond;
            if (this.sentThisSecond > 170 && !(((EventPacket)e).getPacket() instanceof C00PacketKeepAlive) && this.mc.theWorld != null && this.mc.thePlayer != null) {
                ((EventPacket)e).setCancelled(true);
                Client.addChatMessage(ChatFormatting.RED + "Canceled packet: " + ((EventPacket)e).getPacket().getClass().getName() + " due to sending too many packets per second! (Sent: " + this.sentThisSecond + " packets this second)");
            }
        }
    }
}
